<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ“š æ¨èç³»ç»Ÿå­¦ä¹ èµ„æ–™</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            max-width: 1000px;
            margin: 40px auto;
            padding: 0 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 30px;
        }
        h1 {
            color: #1a73e8;
            border-bottom: 2px solid #e8f0fe;
            padding-bottom: 15px;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        h1:before {
            content: "ğŸ“š";
            font-size: 32px;
        }
        
        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        #searchInput {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e8f0fe;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
            outline: none;
        }
        #searchInput:focus {
            border-color: #1a73e8;
        }
        #searchInput::placeholder {
            color: #9aa0a6;
        }
        .clear-search {
            padding: 0 16px;
            background: #f1f3f4;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #5f6368;
            transition: background 0.2s;
        }
        .clear-search:hover {
            background: #e8eaed;
        }
        
        .file-tree {
            margin-top: 20px;
            min-height: 200px;
        }
        
        /* æ–‡ä»¶å¤¹æ ·å¼ */
        .folder {
            margin: 4px 0;
        }
        .folder-header {
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            gap: 6px;
            color: #e36209;
            font-weight: 500;
            transition: background 0.2s;
        }
        .folder-header:hover {
            background: #f1f8ff;
        }
        .folder-header .toggle-icon {
            display: inline-block;
            width: 16px;
            text-align: center;
            font-size: 12px;
            color: #5f6368;
        }
        .folder-header .folder-icon {
            font-size: 18px;
        }
        .folder-children {
            margin-left: 24px;
            padding-left: 8px;
            border-left: 1px dashed #dadce0;
        }
        .folder-children.collapsed {
            display: none;
        }
        
        /* æ–‡ä»¶æ ·å¼ */
        .file-item {
            padding: 6px 8px 6px 32px;
            border-radius: 4px;
            transition: background 0.2s;
            position: relative;
        }
        .file-item:hover {
            background: #f1f8ff;
        }
        .file-item a {
            text-decoration: none;
            color: #1a73e8;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .file-item a:hover {
            text-decoration: underline;
        }
        .file-icon {
            font-size: 16px;
        }
        .hf-badge {
            display: inline-block;
            margin-left: 6px;
            font-size: 11px;
            background: #fef3c7;
            color: #92400e;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 500;
            border: 1px solid #fcd34d;
        }
        
        /* åŒ¹é…é«˜äº® */
        .file-item.highlight {
            background: #fff3e0;
            border-left: 3px solid #f9ab00;
        }
        .folder-header.highlight {
            background: #fff3e0;
        }
        
        /* ç©ºçŠ¶æ€å’ŒåŠ è½½ */
        .loading, .error, .no-results {
            padding: 40px;
            text-align: center;
            color: #5f6368;
        }
        .error {
            color: #d93025;
        }
        .stats {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e8f0fe;
            color: #5f6368;
            font-size: 14px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ¨èç³»ç»Ÿå­¦ä¹ èµ„æ–™</h1>
        
        <!-- æœç´¢æ¡† -->
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹... (æ”¯æŒæ‹¼éŸ³)" autocomplete="off">
            <button class="clear-search" id="clearSearch">æ¸…é™¤</button>
        </div>
        
        <div id="file-list" class="file-tree">
            <div class="loading">ğŸ“‚ åŠ è½½æ–‡ä»¶åˆ—è¡¨ä¸­...</div>
        </div>
        
        <div id="stats" class="stats"></div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯
        const username = 'hfhfn';
        const repo = 'rec_sys_guide';
        const branch = 'main';

        // å­˜å‚¨æ‰€æœ‰æ–‡ä»¶çš„åŸå§‹æ•°æ®
        let allFilesData = [];
        // å­˜å‚¨å½“å‰çš„æœç´¢å…³é”®è¯
        let currentSearchTerm = '';
        // å­˜å‚¨ HuggingFace å¤§æ–‡ä»¶æ˜ å°„
        let hfFileMap = {};

        // è·å–æ–‡ä»¶å›¾æ ‡ï¼ˆæ ¹æ®æ‰©å±•åï¼‰
        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const iconMap = {
                // æ–‡æ¡£ç±»
                'pdf': 'ğŸ“„', 'doc': 'ğŸ“˜', 'docx': 'ğŸ“˜', 'txt': 'ğŸ“ƒ', 'md': 'ğŸ“',
                // ä»£ç ç±»
                'html': 'ğŸŒ', 'htm': 'ğŸŒ', 'css': 'ğŸ¨', 'js': 'âš¡', 'py': 'ğŸ', 
                'java': 'â˜•', 'cpp': 'âš™ï¸', 'c': 'âš™ï¸', 'php': 'ğŸ˜', 'json': 'ğŸ“Š',
                // å›¾ç‰‡ç±»
                'jpg': 'ğŸ–¼ï¸', 'jpeg': 'ğŸ–¼ï¸', 'png': 'ğŸ–¼ï¸', 'gif': 'ğŸï¸', 'svg': 'ğŸ–Œï¸',
                // å‹ç¼©åŒ…
                'zip': 'ğŸ“¦', 'rar': 'ğŸ“¦', '7z': 'ğŸ“¦', 'tar': 'ğŸ“¦', 'gz': 'ğŸ“¦',
                // å…¶ä»–
                'exe': 'âš™ï¸', 'dmg': 'ğŸ’¿', 'iso': 'ğŸ’¿', 'mp4': 'ğŸ¬', 'mp3': 'ğŸµ'
            };
            return iconMap[ext] || 'ğŸ“„'; // é»˜è®¤ä½¿ç”¨ ğŸ“„
        }

        // åˆ‡æ¢æ–‡ä»¶å¤¹æŠ˜å çŠ¶æ€
        function toggleFolder(event) {
            const header = event.currentTarget;
            const children = header.nextElementSibling;
            const toggleIcon = header.querySelector('.toggle-icon');
            
            if (children && children.classList.contains('folder-children')) {
                if (children.classList.contains('collapsed')) {
                    children.classList.remove('collapsed');
                    toggleIcon.textContent = 'â–¼';
                } else {
                    children.classList.add('collapsed');
                    toggleIcon.textContent = 'â–¶';
                }
            }
            event.stopPropagation();
        }

        // é€’å½’æ„å»ºæ ‘å½¢ç»“æ„
        function buildFileTree(files) {
            const tree = {};
            
            files.forEach(file => {
                const pathParts = file.path.split('/');
                let currentLevel = tree;
                const fileName = pathParts.pop();

                // éå†è·¯å¾„ä¸­çš„æ¯ä¸€çº§ç›®å½•
                pathParts.forEach(folder => {
                    if (!currentLevel[folder]) {
                        currentLevel[folder] = {};
                    }
                    currentLevel = currentLevel[folder];
                });

                // åœ¨æœ€ç»ˆå±‚çº§å­˜æ”¾æ–‡ä»¶åå’Œå®ƒçš„å®Œæ•´è·¯å¾„
                if (!currentLevel._files) {
                    currentLevel._files = [];
                }
                currentLevel._files.push({
                    name: fileName,
                    fullPath: file.path,
                    ext: fileName.split('.').pop().toLowerCase()
                });
            });
            
            return tree;
        }

        // é€’å½’æ¸²æŸ“æ ‘å½¢ç»“æ„
        function renderTree(node, level = 0, searchTerm = '') {
            let html = '';
            const lowerSearchTerm = searchTerm.toLowerCase();
            
            // è·å–æ‰€æœ‰æ–‡ä»¶å¤¹ï¼ˆæŒ‰å­—æ¯æ’åºï¼‰
            const folders = Object.keys(node)
                .filter(key => key !== '_files')
                .sort((a, b) => a.localeCompare(b));

            // æ¸²æŸ“æ–‡ä»¶å¤¹
            folders.forEach(folder => {
                // åˆ¤æ–­æ–‡ä»¶å¤¹æ˜¯å¦åŒ¹é…æœç´¢ï¼ˆé€’å½’æ£€æŸ¥å­æ–‡ä»¶ï¼‰
                const folderMatches = searchTerm === '' || doesFolderMatchSearch(node[folder], searchTerm);
                
                if (searchTerm !== '' && !folderMatches) {
                    return; // æœç´¢æ¨¡å¼ä¸‹ï¼Œä¸åŒ¹é…çš„æ–‡ä»¶å¤¹ç›´æ¥è·³è¿‡
                }
                
                html += `
                    <div class="folder">
                        <div class="folder-header" onclick="toggleFolder(event)">
                            <span class="toggle-icon">${searchTerm === '' ? 'â–¶' : 'â–¼'}</span>
                            <span class="folder-icon">ğŸ“</span>
                            <span>${folder}/</span>
                        </div>
                        <div class="folder-children ${searchTerm === '' ? 'collapsed' : ''}">
                            ${renderTree(node[folder], level + 1, searchTerm)}
                        </div>
                    </div>
                `;
            });

            // æ¸²æŸ“å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶
            if (node._files && node._files.length > 0) {
                node._files.sort((a, b) => a.name.localeCompare(b.name)).forEach(file => {
                    // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åŒ¹é…æœç´¢
                    const fileNameLower = file.name.toLowerCase();
                    const matches = searchTerm === '' || fileNameLower.includes(lowerSearchTerm);
                    
                    if (searchTerm !== '' && !matches) {
                        return; // æœç´¢æ¨¡å¼ä¸‹ï¼Œä¸åŒ¹é…çš„æ–‡ä»¶ç›´æ¥è·³è¿‡
                    }
                    
                    const icon = getFileIcon(file.name);
                    const highlight = searchTerm !== '' && fileNameLower.includes(lowerSearchTerm) ? 'highlight' : '';

                    // æ£€æŸ¥æ˜¯å¦æ˜¯ HuggingFace å¤§æ–‡ä»¶
                    const isHFFile = hfFileMap[file.fullPath];
                    const fileUrl = isHFFile ? isHFFile.url : file.fullPath;
                    const hfBadge = isHFFile ? '<span style="margin-left: 6px; font-size: 12px; background: #fef3c7; color: #92400e; padding: 2px 6px; border-radius: 3px;">ğŸ¤— HF</span>' : '';

                    html += `
                        <div class="file-item ${highlight}">
                            <a href="${fileUrl}" target="_blank" title="${isHFFile ? `æ¥è‡ª HuggingFace (${isHFFile.size_mb}MB)` : ''}">
                                <span class="file-icon">${icon}</span>
                                <span>${file.name}</span>
                                ${hfBadge}
                            </a>
                        </div>
                    `;
                });
            }

            return html;
        }

        // æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦åŒ…å«åŒ¹é…æœç´¢çš„æ–‡ä»¶ï¼ˆé€’å½’ï¼‰
        function doesFolderMatchSearch(node, searchTerm) {
            const lowerSearchTerm = searchTerm.toLowerCase();
            
            // æ£€æŸ¥å½“å‰å±‚çº§çš„æ–‡ä»¶
            if (node._files) {
                for (const file of node._files) {
                    if (file.name.toLowerCase().includes(lowerSearchTerm)) {
                        return true;
                    }
                }
            }
            
            // é€’å½’æ£€æŸ¥å­æ–‡ä»¶å¤¹
            const folders = Object.keys(node).filter(key => key !== '_files');
            for (const folder of folders) {
                if (doesFolderMatchSearch(node[folder], searchTerm)) {
                    return true;
                }
            }
            
            return false;
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(files) {
            // ç»Ÿè®¡å„ç§æ–‡ä»¶ç±»å‹
            const extCount = {};
            files.forEach(f => {
                const ext = f.path.split('.').pop().toLowerCase();
                extCount[ext] = (extCount[ext] || 0) + 1;
            });
            
            // å–å‰5ä¸ªæœ€å¤šçš„æ‰©å±•å
            const topExts = Object.entries(extCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .map(([ext, count]) => `${ext}: ${count}ä¸ª`);
            
            const folderSet = new Set();
            files.forEach(f => {
                const pathParts = f.path.split('/');
                if (pathParts.length > 1) {
                    for (let i = 1; i < pathParts.length; i++) {
                        folderSet.add(pathParts.slice(0, i).join('/'));
                    }
                }
            });
            
            const statsDiv = document.getElementById('stats');
            statsDiv.innerHTML = `
                <span>ğŸ“ æ–‡ä»¶å¤¹: ${folderSet.size} ä¸ª</span>
                <span>ğŸ“„ æ–‡ä»¶æ€»æ•°: ${files.length} ä¸ª</span>
                <span>ğŸ”¤ ä¸»è¦ç±»å‹: ${topExts.join(' Â· ')}</span>
            `;
        }

        // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨ï¼ˆæ ¹æ®æœç´¢è¯ï¼‰
        function refreshFileList() {
            if (allFilesData.length === 0) return;
            
            // æ„å»ºæ ‘å½¢ç»“æ„
            const fileTree = buildFileTree(allFilesData);
            
            // æ¸²æŸ“æ–‡ä»¶æ ‘ï¼ˆä¼ å…¥æœç´¢è¯ï¼‰
            const treeHtml = renderTree(fileTree, 0, currentSearchTerm);
            
            if (treeHtml.trim() === '') {
                document.getElementById('file-list').innerHTML = '<div class="no-results">ğŸ” æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ä»¶</div>';
            } else {
                document.getElementById('file-list').innerHTML = treeHtml;
            }
        }

        // ä¸»å‡½æ•°ï¼šè·å–å¹¶æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨
        async function listAllFiles() {
            try {
                // 1. åŠ è½½ HuggingFace æ–‡ä»¶æ¸…å•
                try {
                    const manifestResponse = await fetch('./data/file_manifest.json');
                    if (manifestResponse.ok) {
                        const manifest = await manifestResponse.json();
                        // æ„å»º HF æ–‡ä»¶æ˜ å°„
                        manifest.files.forEach(file => {
                            hfFileMap[file.path] = {
                                url: file.url,
                                size_mb: file.size_mb
                            };
                        });
                        console.log(`âœ… å·²åŠ è½½ ${manifest.files.length} ä¸ª HuggingFace æ–‡ä»¶æ¸…å•`);
                    }
                } catch (e) {
                    console.warn('âš ï¸ æœªæ‰¾åˆ° HuggingFace æ–‡ä»¶æ¸…å•ï¼Œä»…æ˜¾ç¤º GitHub æ–‡ä»¶');
                }

                // 2. è·å– GitHub ä¸Šçš„æ–‡ä»¶åˆ—è¡¨
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/git/trees/${branch}?recursive=1`);
                const data = await response.json();

                if (!data.tree) {
                    throw new Error('æ— æ³•è·å–æ–‡ä»¶åˆ—è¡¨');
                }

                // ä¸å†è¿‡æ»¤æ–‡ä»¶ç±»å‹ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶
                allFilesData = data.tree.filter(item => {
                    return item.type === 'blob' &&
                           item.path.split('/').pop() !== 'index.html' &&
                           item.path.split('/').pop() !== 'README.md' &&
                           !item.path.startsWith('.github/') &&
                           !item.path.startsWith('scripts/') &&
                           !item.path.startsWith('data/');
                });

                if (allFilesData.length === 0) {
                    document.getElementById('file-list').innerHTML = '<div class="loading">ğŸ“‚ æš‚æ— æ–‡ä»¶</div>';
                    return;
                }

                // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
                refreshFileList();

                // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                updateStats(allFilesData);

            } catch (error) {
                document.getElementById('file-list').innerHTML = `
                    <div class="error">
                        âŒ åŠ è½½å¤±è´¥: ${error.message}<br>
                        <span style="font-size: 14px;">å¦‚æœæŒç»­å¤±è´¥ï¼Œå¯èƒ½æ˜¯ GitHub API é™åˆ¶ï¼Œç¨ç­‰å‡ åˆ†é’Ÿå†åˆ·æ–°ã€‚</span>
                    </div>
                `;
                console.error(error);
            }
        }

        // æœç´¢åŠŸèƒ½
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const clearButton = document.getElementById('clearSearch');
            
            // é˜²æŠ–å‡½æ•°ï¼Œé¿å…é¢‘ç¹æ¸²æŸ“
            let debounceTimer;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                debounceTimer = setTimeout(() => {
                    currentSearchTerm = e.target.value.trim();
                    refreshFileList();
                }, 300);
            });
            
            // æ¸…é™¤æœç´¢
            clearButton.addEventListener('click', () => {
                searchInput.value = '';
                currentSearchTerm = '';
                refreshFileList();
                searchInput.focus();
            });
            
            // æ”¯æŒå›è½¦ç›´æ¥æœç´¢
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    clearTimeout(debounceTimer);
                    currentSearchTerm = e.target.value.trim();
                    refreshFileList();
                }
            });
        }

        // å¯åŠ¨
        listAllFiles();
        setupSearch();
    </script>
</body>
</html>